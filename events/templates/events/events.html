{% extends "base.html" %}
{% load static %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/fullcalendar.css' %}">
    <link rel="stylesheet" href="{% static 'css/events.css' %}">
{% endblock %}

{% block extra_js %}
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.17/index.global.min.js" ></script>
    <script src="{% static 'js/events.js' %}" type="module"></script>    
{% endblock %}

{% block content %}
    <h1>What's on in store</h1>
    {% if request.user.is_staff %}
        <button id="addEventBtn">Add Event</button>
    {% endif %}

    <section aria-label="Event calendar">
        <div id="calendar"></div>
    </section>


    {% if request.user.is_staff %}
        <div id="addModal" class="modal">
            <div class="modal-content">
                <button class="close" aria-label="Close modal">
                    <i class="fa-solid fa-xmark" aria-hidden="true"></i>
                </button>
                <h2>Add Event</h2>
                <fieldset>
                    <legend>Add Event</legend>
                    <form id="event-form" action="{% url 'add_event' %}" method="POST">
                        {% csrf_token %}
                        
                        <label for="title">Title:</label>
                        <input type="text" id="title" name="title" required>
                    
                        <label for="description">Description:</label>
                        <textarea id="description" name="description"></textarea>

                        <label for="date">Date:</label>
                        <input type="date" id="date" name="date" required>
                    
                        <label for="start_time">Start Time:</label>
                        <input type="time" id="start_time" name="start_time" required>
                    
                        <label for="end_time">End Time:</label>
                        <input type="time" id="end_time" name="end_time" required>

                        <label for="recurrence">Recurrence:</label>
                        <select id="recurrence" name="recurrence">
                            <option value="none">None</option>
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="monthly">Monthly</option>
                        </select>
                        
                        <button type="submit">Save Event</button>
                    </form>
                </fieldset>
            </div>
        </div>
        
        <div id="editModal" class="modal">
            <div class="modal-content">
                <button class="close" aria-label="Close modal">
                <i class="fa-solid fa-xmark" aria-hidden="true"></i>
                </button>

                <h2>Edit Event</h2>
                <form id="editEventForm" method="POST">
                {% csrf_token %}
                    <fieldset>
                        <legend>Edit Event</legend>

                        <input type="hidden" id="editEventId" name="event_id">

                        <label for="editTitle">Title:</label>
                        <input type="text" id="editTitle" name="title" required>

                        <label for="editDescription">Description:</label>
                        <textarea id="editDescription" name="description"></textarea>

                        <label for="editDate">Date:</label>
                        <input type="date" id="editDate" name="date" required>

                        <label for="editStartTime">Start Time:</label>
                        <input type="time" id="editStartTime" name="start-time" required>

                        <label for="editEndTime">End Time:</label>
                        <input type="time" id="editEndTime" name="end-time" required>

                        <label for="editRecurrence" class="sr-only">Recurrence:</label>
                        <select id="editRecurrence" name="recurrence" aria-hidden="true" tabindex="-1">
                        <option value="none">None</option>
                        <option value="daily">Daily</option>
                        <option value="weekly">Weekly</option>
                        <option value="monthly">Monthly</option>
                        </select>

                        <button type="submit">Save Changes</button>
                        <button type="button" id="deleteEventBtn">Delete Event</button>
                    </fieldset>
                </form>
            </div>
            </div>

    {% else %}
        <div id="view-modal" class="modal">
            <div class="modal-content">
                <button class="close" aria-label="Close modal">
                    <i class="fa-solid fa-xmark" aria-hidden="true"></i>
                </button>

                <h2 id="title"></h2>
                <p id="description"></p>
                <p id="startTime"><strong>Start Time: </strong></p>
                <p id="endTime"><strong>End Time: </strong></p>
            </div>
        </div>
    {% endif %}
{% endblock %}
